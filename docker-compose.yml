services:
  app:
    container_name: pw
    image: tinyops/pw:1.11.1
    restart: always
    environment:
      PW_LISTEN: "0.0.0.0:8080"
      PW_LOG_LEVEL: "info"
      PW_MESSAGE_MAX_LENGTH: "3127"
      PW_ENCRYPTED_MESSAGE_MAX_LENGTH: "15485760"
      PW_FILE_UPLOAD_ENABLED: "true"
      PW_FILE_MAX_SIZE: "1048576"
      PW_REDIS_URL: "redis://redis:6379/"
      PW_LOG_TARGET: "console"
      # Rate limiting configuration (per-route)
      PW_RATE_LIMIT_POST_SECRET_ENABLED: "true"
      PW_RATE_LIMIT_POST_SECRET_REQUESTS_PER_MINUTE: "120"
      PW_RATE_LIMIT_POST_SECRET_BURST_SIZE: "30"
      PW_RATE_LIMIT_GET_SECRET_ENABLED: "true"
      PW_RATE_LIMIT_GET_SECRET_REQUESTS_PER_MINUTE: "600"
      PW_RATE_LIMIT_GET_SECRET_BURST_SIZE: "100"
      PW_RATE_LIMIT_DELETE_SECRET_ENABLED: "true"
      PW_RATE_LIMIT_DELETE_SECRET_REQUESTS_PER_MINUTE: "120"
      PW_RATE_LIMIT_DELETE_SECRET_BURST_SIZE: "30"
      # CORS configuration
      PW_CORS_ENABLED: "true"
      PW_CORS_ALLOWED_ORIGINS: "https://example.com, https://app.example.com"
      PW_CORS_ALLOWED_METHODS: "GET, POST, DELETE, OPTIONS"
      PW_CORS_ALLOWED_HEADERS: "Content-Type, Authorization"
      PW_CORS_ALLOW_CREDENTIALS: "false"
      PW_CORS_MAX_AGE: "3600"
    #volumes:
    #- ./pw.yml:/app/pw.yml
    ports:
      - "8080:8080"

  redis:
    container_name: pw-redis
    image: redis:8.4.0-alpine3.22
    restart: always
    command: 'redis-server --save "" --appendonly no --maxmemory 128mb'
    # ports:
    #   - "6379:6379"
